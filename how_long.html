<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NOFNWAY | HOW LONG?</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f172a; --card-bg: #1e293b; --text-main: #f8fafc; --text-dim: #94a3b8;
            --border: #334155; --brand: #3b82f6; --accent-blue: #3b82f6; 
            --accent-yellow: #facc15; --accent-green: #4ade80; --accent-orange: #f97316; --danger: #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Roboto', sans-serif; background: var(--bg); color: var(--text-main); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        .navbar { background: #000; padding: 10px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--brand); flex-shrink: 0; }
        .brand { font-family: 'Montserrat', sans-serif; font-weight: 900; font-size: 1.5rem; text-decoration: none; color: white; }
        .brand span { color: var(--brand); }

        .workspace { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 0.75rem; max-width: 600px; margin: 0 auto; width: 100%; }

        /* Material Chips */
        .material-bar { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; flex-shrink: 0; }
        .material-chip { padding: 6px 12px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 20px; font-size: 0.7rem; font-weight: 700; white-space: nowrap; cursor: pointer; }
        .material-chip.active { border-color: var(--accent-yellow); color: var(--accent-yellow); background: rgba(250, 204, 21, 0.1); }

        /* Interactive Tape Styling */
        .tape-container { background: #facc15; border: 2px solid #000; border-radius: 0.5rem; height: 110px; position: relative; overflow: hidden; touch-action: none; cursor: grab; flex-shrink: 0; }
        .center-wire { position: absolute; left: 50%; top: 0; bottom: 0; width: 3px; background: #ef4444; z-index: 50; pointer-events: none; }
        .tape-strip { position: absolute; height: 100%; display: flex; align-items: flex-end; will-change: transform; }
        .tape-tick { position: absolute; bottom: 0; width: 1px; background: #000; }
        .tick-inch { height: 65%; width: 2px; }
        .tape-label { position: absolute; top: 12px; font-weight: 900; color: #000; transform: translateX(-50%); font-size: 1.4rem; font-family: 'Montserrat'; }

        .readout-card { background: var(--card-bg); border-left: 4px solid var(--accent-blue); border-radius: 0.75rem; padding: 1rem; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .readout-val { font-size: 2.2rem; font-weight: 800; }
        
        .drawer-container { border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg); overflow: hidden; display: flex; flex-direction: column; flex: 1; min-height: 150px; }
        .tab { flex: 1; padding: 0.75rem; text-align: center; font-size: 0.75rem; font-weight: 800; background: var(--card-bg); cursor: pointer; color: var(--text-dim); }
        .tab.active { background: var(--bg); color: var(--text-main); border-bottom: 2px solid var(--accent-blue); }

        .list-view { padding: 0.5rem; overflow-y: auto; flex: 1; }
        .group-header { font-size: 0.65rem; color: var(--accent-yellow); font-weight: 900; margin: 12px 0 6px 0; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid var(--border); padding-bottom: 2px; }
        .item-card { background: var(--card-bg); padding: 0.75rem; border-radius: 6px; margin-bottom: 4px; border-left: 3px solid var(--border); display: flex; justify-content: space-between; align-items: center; }

        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; flex-shrink: 0; }
        .field { background: var(--card-bg); border: 1px solid var(--border); border-radius: 0.5rem; padding: 0.5rem; }
        .field.active { border-color: var(--accent-blue); background: rgba(59, 130, 246, 0.1); }
        .field-lbl { font-size: 0.6rem; font-weight: 700; color: var(--text-dim); }
        .field-val { font-family: monospace; font-size: 1.2rem; min-height: 1.5rem; }

        .keypad { background: var(--card-bg); padding: 0.5rem; display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; height: 220px; flex-shrink: 0; }
        .key { background: var(--bg); border: 1px solid var(--border); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; cursor: pointer; }
        .key-mark { background: var(--accent-green); color: black; font-weight: 900; grid-column: span 2; }
        
        .cursor { display: inline-block; width: 2px; height: 1em; background: var(--accent-blue); animation: blink 1s infinite; vertical-align: middle; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body>

<nav class="navbar">
    <a href="#" class="brand">NO<span>FN</span>WAY</a>
    <span onclick="resetAll()" style="color:var(--danger); font-size:0.7rem; font-weight:bold; cursor:pointer;">RESET</span>
</nav>

<main class="workspace">
    <div class="material-bar" id="material-bar"></div>

    <div class="tape-container" id="tape-viewport">
        <div class="center-wire"></div>
        <div class="tape-strip" id="tape-strip"></div>
    </div>

    <div class="readout-card">
        <div>
            <div id="qty-badge" style="color:var(--accent-blue); font-size:0.7rem; font-weight:bold;">QTY: 1</div>
            <div id="main-disp" class="readout-val">0"</div>
            <div id="sub-disp" style="font-family:monospace; color:var(--text-dim); font-size:0.8rem;">Select Material & Length</div>
        </div>
    </div>

    <div class="drawer-container">
        <div style="display:flex; border-bottom:1px solid var(--border);">
            <div class="tab active" id="tab-cut" onclick="switchTab('cut')">CUT LIST</div>
            <div class="tab" id="tab-buy" onclick="switchTab('buy')">BUY LIST</div>
        </div>
        <div class="list-view" id="list-container"></div>
    </div>

    <div class="input-row">
        <div class="field" id="field-primary" onclick="setActive('primary')">
            <span class="field-lbl">FEET</span>
            <div class="field-val" id="val-primary"></div>
        </div>
        <div class="field active" id="field-secondary" onclick="setActive('secondary')">
            <span class="field-lbl">INCHES</span>
            <div class="field-val" id="val-secondary"><span class="cursor"></span></div>
        </div>
    </div>
</main>

<div class="keypad">
    <div class="key" onclick="press('7')">7</div>
    <div class="key" onclick="press('8')">8</div>
    <div class="key" onclick="press('9')">9</div>
    <div class="key" onclick="press('back')" style="color:var(--danger)">âŒ«</div>
    <div class="key" onclick="press('4')">4</div>
    <div class="key" onclick="press('5')">5</div>
    <div class="key" onclick="press('6')">6</div>
    <div class="key" onclick="press('clr')" style="font-size:0.8rem">CLR</div>
    <div class="key" onclick="press('1')">1</div>
    <div class="key" onclick="press('2')">2</div>
    <div class="key" onclick="press('3')">3</div>
    <div class="key" onclick="press('x')" style="color:var(--accent-orange)">x</div>
    <div class="key" onclick="press('0')">0</div>
    <div class="key" onclick="press('.')">.</div>
    <div class="key key-mark" onclick="markMeasurement()">MARK</div>
</div>

<script>
    const state = {
        activeField: 'secondary',
        vals: { primary: '', secondary: '0' },
        multiplier: 1,
        qtyMode: false,
        activeMaterial: '2x4 Lumber',
        materials: ['2x4 Lumber', '4x4 Post', '2x6 SPF', 'PVC Pipe', 'Trim'],
        items: JSON.parse(localStorage.getItem('nofnway-howlong-data')) || [],
        view: 'cut',
        pixelsPerInch: 200,
        kerf: 0.125 // 1/8" Blade width
    };

    window.onload = () => { renderMaterials(); initTape(); renderFields(); renderList(); calculate(); };

    function saveToDisk() { localStorage.setItem('nofnway-howlong-data', JSON.stringify(state.items)); }

    function renderMaterials() {
        const bar = document.getElementById('material-bar');
        bar.innerHTML = state.materials.map(m => `
            <div class="material-chip ${state.activeMaterial === m ? 'active' : ''}" onclick="setMaterial('${m}')">${m}</div>
        `).join('') + `<div class="material-chip" onclick="addMaterial()">+ ADD</div>`;
    }

    function setMaterial(m) { state.activeMaterial = m; renderMaterials(); renderList(); calculate(); }

    function addMaterial() {
        const name = prompt("Material Name (e.g. 1x6 Pine):");
        if(name) { state.materials.push(name); state.activeMaterial = name; renderMaterials(); }
    }

    function initTape() {
        const strip = document.getElementById('tape-strip');
        strip.innerHTML = '';
        for (let i = 0; i <= 13 * 32; i++) {
            const tick = document.createElement('div');
            tick.className = 'tape-tick';
            const pos = (i / 32) * state.pixelsPerInch;
            tick.style.left = pos + 'px';
            if (i % 32 === 0) {
                tick.classList.add('tick-inch');
                const lbl = document.createElement('div');
                lbl.className = 'tape-label';
                lbl.innerText = i / 32;
                lbl.style.left = pos + 'px';
                strip.appendChild(lbl);
            }
            strip.appendChild(tick);
        }
        updateTapePosition();
    }

    function updateTapePosition() {
        const strip = document.getElementById('tape-strip');
        const view = document.getElementById('tape-viewport');
        const val = parseFloat(state.vals.secondary) || 0;
        const offset = (val * state.pixelsPerInch) - (view.offsetWidth / 2);
        strip.style.transform = `translateX(${-offset}px)`;
    }

    function press(key) {
        if (key === 'x') { state.qtyMode = true; state.multiplier = 0; renderFields(); return; }
        if (state.qtyMode) {
            if (key === 'clr') { state.multiplier = 1; state.qtyMode = false; }
            else if (/[0-9]/.test(key)) state.multiplier = parseInt(state.multiplier.toString() + key);
            renderFields(); return;
        }
        let v = state.vals[state.activeField];
        if (key === 'clr') v = '';
        else if (key === 'back') v = v.slice(0, -1);
        else v += key;
        state.vals[state.activeField] = v;
        if(state.activeField === 'secondary') updateTapePosition();
        calculate(); renderFields();
    }

    function calculate() {
        const p = parseFloat(state.vals.primary) || 0, s = parseFloat(state.vals.secondary) || 0;
        let inches = (p * 12) + s;
        const main = document.getElementById('main-disp');
        let f = Math.floor(inches / 12), i = Math.floor(inches % 12), frac = inches % 1;
        let num = Math.round(frac * 32);
        if(num === 32) { num = 0; i++; if(i === 12) { i = 0; f++; } }
        main.innerHTML = `${f > 0 ? f + "' " : ""}${i}${num > 0 ? ` <span style="color:var(--accent-blue)">${num}/32</span>` : ""}"`;
        document.getElementById('sub-disp').innerText = `${state.activeMaterial} | ${inches.toFixed(3)}"`;
        return inches;
    }

    function markMeasurement() {
        const len = calculate();
        if (len <= 0) return;
        state.items.unshift({ 
            id: Date.now(), 
            material: state.activeMaterial, 
            qty: state.multiplier || 1, 
            len, 
            display: document.getElementById('main-disp').innerText 
        });
        state.multiplier = 1; state.qtyMode = false;
        saveToDisk(); renderList(); renderFields();
    }

    function renderList() {
        const container = document.getElementById('list-container'); container.innerHTML = '';
        const groups = state.items.reduce((acc, item) => {
            if (!acc[item.material]) acc[item.material] = [];
            acc[item.material].push(item);
            return acc;
        }, {});

        if (state.view === 'cut') {
            Object.keys(groups).forEach(mat => {
                container.innerHTML += `<div class="group-header">${mat}</div>`;
                groups[mat].forEach(item => {
                    container.innerHTML += `
                        <div class="item-card" style="border-left-color:${mat === state.activeMaterial ? 'var(--accent-yellow)' : 'var(--border)'}">
                            <div><b>${item.qty}x ${item.display}</b></div>
                            <div style="font-size:0.7rem; opacity:0.6">${item.len.toFixed(2)}"</div>
                        </div>`;
                });
            });
        } else {
            Object.keys(groups).forEach(mat => {
                container.innerHTML += `<div class="group-header">${mat} (Total Order)</div>`;
                let pool = [];
                groups[mat].forEach(i => { for(let x=0; x<i.qty; x++) pool.push(i.len + state.kerf); });
                pool.sort((a,b) => b-a);
                let counts = { 96: 0, 120: 0, 144: 0 };
                while(pool.length > 0) {
                    let p = pool.shift();
                    let stock = [96, 120, 144].find(s => s >= p);
                    if(!stock) { container.innerHTML += `<div class="item-card" style="color:var(--danger)">Item too long for standard stock!</div>`; break; }
                    counts[stock]++;
                    let rem = stock - p;
                    for(let k=0; k<pool.length; k++) { if(pool[k] <= rem) { rem -= pool[k]; pool.splice(k, 1); k--; } }
                }
                [96, 120, 144].forEach(s => {
                    if(counts[s]) container.innerHTML += `<div class="item-card" style="border-left-color:var(--accent-orange)"><b>${counts[s]}x ${s/12}' (${s}")</b></div>`;
                });
            });
        }
    }

    function renderFields() {
        document.getElementById('field-primary').className = 'field' + (state.activeField === 'primary' ? ' active' : '');
        document.getElementById('field-secondary').className = 'field' + (state.activeField === 'secondary' ? ' active' : '');
        document.getElementById('val-primary').innerHTML = state.vals.primary + (state.activeField === 'primary' ? '<span class="cursor"></span>' : '');
        document.getElementById('val-secondary').innerHTML = state.vals.secondary + (state.activeField === 'secondary' ? '<span class="cursor"></span>' : '');
        document.getElementById('qty-badge').innerText = `QTY: ${state.multiplier}`;
    }

    function setActive(f) { state.activeField = f; renderFields(); }
    function switchTab(t) { state.view = t; document.getElementById('tab-cut').className = 'tab' + (t==='cut'?' active':''); document.getElementById('tab-buy').className = 'tab' + (t==='buy'?' active':''); renderList(); }
    function resetAll() { if(confirm('Wipe all project data?')) { state.items = []; saveToDisk(); renderList(); } }

    /* Touch Drag Logic */
    let isDragging = false, startX, startVal;
    const vPort = document.getElementById('tape-viewport');
    const handleStart = (e) => { isDragging = true; startX = (e.pageX || e.touches[0].pageX); startVal = parseFloat(state.vals.secondary) || 0; };
    const handleMove = (e) => {
        if (!isDragging) return;
        const x = (e.pageX || e.touches[0].pageX);
        const diff = (startX - x) / state.pixelsPerInch;
        let newVal = Math.max(0, Math.min(12, Math.round((startVal + diff) * 32) / 32));
        state.vals.secondary = newVal.toString();
        state.activeField = 'secondary';
        updateTapePosition(); calculate(); renderFields();
    };
    vPort.addEventListener('mousedown', handleStart);
    vPort.addEventListener('touchstart', handleStart);
    window.addEventListener('mousemove', handleMove);
    window.addEventListener('touchmove', handleMove);
    window.addEventListener('mouseup', () => isDragging = false);
    window.addEventListener('touchend', () => isDragging = false);
</script>
</body>
</html>
